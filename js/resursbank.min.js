/*!
 * Resurs Bank Payment Gateway for WooCommerce - Scripthandler
 */
;var $RB=jQuery.noConflict();$RB(document).ready(function(a){if($RB("#ssnCustomerType").length&&$RB("#ssnCustomerType:checked").length>0){getMethodType($RB("#ssnCustomerType:checked").val())}$RB('input[id*="payment_method_"]').each(function(){if(typeof $RB().live==="function"){$RB("#"+this.id).live("click",function(){methodChangers(this)})}else{$RB("#"+this.id).on("click",function(){methodChangers(this)})}});woocommerce_resurs_bank={init:function(){var b=this;b.register_payment_update();b.register_ssn_address_fetch();b.shipping_address=a(".shipping_address");b.sign_notice=a("<p></p>").addClass("sign_notice").text(getResursPhrase("deliveryRequiresSigning"));if(a(".resurs-bank-payment-method").length!==0){b.shipping_address.prepend(b.sign_notice)}else{if(a(b.shipping_address).find(b.sign_notice).length){this.sign_notice.remove()}}a(document).ajaxStop(function(){b.register_payment_update();if(a(".resurs-bank-payment-method").length!==0){a("#applicant-government-id").val(a("#ssn_field").val());a("#applicant-full-name").val(a("#billing_first_name").val()+" "+a("#billing_last_name").val());a("#applicant-mobile-number").val(a("#billing_phone").val());a("#applicant-telephone-number").val(a("#billing_phone").val());a("#applicant-email-address").val(a("#billing_email").val());b.shipping_address.prepend(b.sign_notice)}else{if(a(b.shipping_address).find(b.sign_notice).length){b.sign_notice.remove()}}});a("#billing_email").on("keyup",function(){if(a("#applicant-email-address").length>0){a("#applicant-email-address").val(a(this).val())}});a("#billing_phone").on("keyup",function(){if(a("#applicant-telephone-number").length>0){a("#applicant-telephone-number").val(a(this).val())}if(a("#applicant-mobile-number").length>0){a("#applicant-mobile-number").val(a(this).val())}});a("#ssn_field").on("keyup",function(){a("#applicant-government-id").val(a(this).val())})},register_payment_update:function(){var e=a("#order_review input[name=payment_method]:checked");var c=a(e).parent();var d=this;if(c.has(".resurs-bank-payment-method").length!==0){var b=c.find(".resurs-bank-payment-method").val()}a('input[name="payment_method"]').on("change",function(){var h=a(this).parent();var g=a(".resurs-bank-payment-method");if(h.has(".resurs-bank-payment-method").length!==0){var f=h.find(".resurs-bank-payment-method").val()}a("body").trigger("update_checkout")})},register_ssn_address_fetch:function(){var e=a("form.checkout");var c=a("#ssn_field");var b=a("#fetch_address");var d=this;c.keypress(function(h){var f=h.keyCoe||h.which;var g=c.val().trim();if(g.length!==0){if(f===13){b.click();h.preventDefault();return false}}});a(b).click(function(h){var f=c.val().trim();var g=a(" #ssnCustomerType:checked ").val();if(d.validate_ssn_address_field(f)){d.fetch_address(f,g)}h.preventDefault();return false})},validate_ssn_address_field:function(b){if(b.trim().length===0){return false}return true},fetch_address:function(b,c){if(typeof wc_checkout_params.ajax_loader_url!=="undefined"){a('form[name="checkout"]').block({message:null,overlayCSS:{background:"#fff url("+wc_checkout_params.ajax_loader_url+") no-repeat center",backgroundSize:"16px 16px",opacity:0.6}})}a.ajax({type:"GET",url:ajax_object.ajax_url,data:{action:"get_address_ajax",ssn:b,customerType:c}}).done(function(h){h=a.parseJSON(h);var i=h;this.ssnP=a('p[class="resurs_ssn_field"]');if(this.ssnP.length===0){this.ssnP=a("#ssn_field_field")}this.ssnInput=this.ssnP.find("input");if(typeof this.ssnP==="undefined"){console.log(getResursPhrase("ssnElementMissing"))}if(typeof h.error!=="undefined"){var g=a('form[name="checkout"]');var f=a("<span></span>",{"class":"ssn-error-message",text:h.error});this.ssnP.append(f);this.ssnInput.css("border-color","#fb7f88");this.ssnErrorTimeout=window.setTimeout(function(){a(".ssn-error-message").fadeOut("slow",function(){a(this.parent).find("input").css("border-color","");a(this).remove()});a('p[class="form-row ssn form-row-wide woocommerce-validated"]').find("input").css("border-color","")},5000)}else{a(".ssn-error-message").remove();this.ssnInput.css("border-color","");var d="";if($RB("#ssnCustomerType").length>0&&$RB('input[id^="payment_method_resurs_bank"]').length>0){var e=$RB("#ssnCustomerType:checked");d=e.val();a("#billing_first_name").val(typeof i.firstName!=="undefined"?i.firstName:"");a("#billing_last_name").val(typeof i.lastName!=="undefined"?i.lastName:"");a("#billing_address_1").val(typeof i.addressRow1!=="undefined"?i.addressRow1:"");a("#billing_address_2").val(typeof i.addressRow1!=="undefined"?i.addressRow2:"");a("#billing_postcode").val(typeof i.postalCode!=="undefined"?i.postalCode:"");a("#billing_city").val(typeof i.postalArea!=="undefined"?i.postalArea:"");a("#applicant-government-id").val(a("#ssn_field").val());if(d!=="NATURAL"){if(typeof i.lastName==="undefined"){a("#billing_company").val(i.firstName)}else{a("#billing_company").val(i.firstName+" "+i.lastName)}}else{a("#billing_last_name").val(typeof i.lastName!=="undefined"?i.lastName:"")}}a('form[name="checkout"]').unblock()}})},remove_first_checkout_button:function(){a(".checkout-button").each(function(b,d){var c=a(d);if(!c.hasClass("second-checkout-button")){c.hide()}})}};woocommerce_resurs_bank.init()});function getResursPhrase(b,a){if(typeof rb_getaddress_fields[b]!=="undefined"){return rb_getaddress_fields[b]}else{if(typeof rb_general_translations[b]!=="undefined"){return rb_general_translations[b]}else{return"Lost in translation on phrase '"+b+"'"}}}function getMethodType(b){var e=null;var g=false;var c="";var f="";var a="";var h="";if($RB("#resursSelectedCountry").length>0&&$RB("#ssn_field").length>0){c=$RB("#resursSelectedCountry").val();f=b.toLowerCase();if(f==="natural"){a=getResursPhrase("getAddressEnterGovernmentId",c);h=getResursPhrase("labelGovernmentId",c)}else{a=getResursPhrase("getAddressEnterCompany",c);h=getResursPhrase("labelCompanyId",c)}$RB("#ssn_field").attr("placeholder",a);$RB("label[for*='ssn_field']").html(h)}if($RB("#ssnCustomerType").length>0&&$RB('input[id^="payment_method_resurs_bank"]').length>0){var d=$RB("#ssnCustomerType:checked");if($RB("#billing_company").length>0&&$RB("#billing_company").val()!==""){b="legal"}else{if(d.length>0){b=d.val()}}$RB('input[id^="payment_method_resurs_bank"]').each(function(j,i){g=true;if($RB("#"+i.id).is(":checked")){e=i.value}});if(b!=""&&g){$RB.ajax({type:"GET",url:ajax_object.ajax_url,data:{action:"get_address_customertype",customerType:b,paymentMethod:e}}).done(function(i){preSetResursMethods(b,i)})}}}function ResursRegexMatch(b,a){}function preSetResursMethods(i,b){var c;var a;if(typeof b.errorstring!=="undefined"){console.log(b.errorstring);return}if(i.toLowerCase()=="natural"){var j="legal"}else{var j="natural"}if(typeof i==="undefined"){return}i=i.toLowerCase();if($RB("#ssnCustomerType:checked").length===0&&($RB("#billing_company").length>0&&$RB("#billing_company").val()=="")){$RB("li[class*=payment_method_resurs]").each(function(){a=document.getElementsByClassName(this.className);if(a.length>0){for(var k=0;k<a.length;k++){if(a[k].tagName.toLowerCase()==="li"){a[k].style.display=""}}}})}else{if(typeof b.natural!=="undefined"&&typeof b.legal!=="undefined"&&typeof b[j]!=="undefined"){for(var f=0;f<b[j].length;f++){c=document.getElementsByClassName("payment_method_"+b[j][f]);if(c.length>0){for(var e=0;e<c.length;e++){if(c[e].tagName.toLowerCase()==="li"){for(var h=0;h<c[e].childNodes.length;h++){if(typeof c[e].childNodes[h].type!=="undefined"&&c[e].childNodes[h].type==="radio"){c[e].childNodes[h].checked=false}}c[e].style.display="none"}}}}for(var f=0;f<b[i].length;f++){a=document.getElementsByClassName("payment_method_"+b[i][f]);if(a.length>0){for(var g=0;g<a.length;g++){if(a[g].tagName.toLowerCase()==="li"){a[g].style.display=""}}}}}}if($RB("#billing_company").length>0){var d=$RB("#ssnCustomerType:checked").val();if(d==="NATURAL"){$RB("#billing_company").val("");$RB("#billing_company").prop("readonly",true)}else{$RB("#billing_company").prop("readonly",false)}}}function methodChangers(a){getMethodType($RB("#ssnCustomerType:checked").val())}if(null!==omnivars){var RESURSCHECKOUT_IFRAME_URL=omnivars.RESURSCHECKOUT_IFRAME_URL}if(typeof ResursCheckout!=="undefined"&&typeof omnivars!=="undefined"&&omnivars!==null){jQuery(document).ready(function(a){if(omnivars.useStandardFieldsForShipping=="1"){console.log("Resurs Bank Note: useStandardFieldsForShipping (Experimental) is active, so customer fields are hidden rather than removed");if(omnivars.showResursCheckoutStandardFieldsTest!=="1"){jQuery(".woocommerce-billing-fields").hide();jQuery(".woocommerce-shipping-fields").hide()}else{if(omnivars.isResursTest!=="1"){jQuery(".woocommerce-billing-fields").hide();jQuery(".woocommerce-shipping-fields").hide()}}}else{jQuery("div").remove(".woocommerce-billing-fields");jQuery("div").remove(".woocommerce-shipping-fields")}});var resursCheckout=ResursCheckout("#resurs-checkout-container");if(typeof omnivars.isResursTest!=="undefined"&&omnivars.isResursTest!==null&&omnivars.isResursTest=="1"){resursCheckout.setDebug(1)}resursCheckout.init();resursCheckout.setPurchaseFailCallback(function(){var b;if(typeof omnivars.OmniRef!=="undefined"){b=omnivars.OmniRef;var a=omnivars.OmniPreBookUrl+"&pRef="+b+"&purchaseFail=1&set-no-session=1";$RB.ajax({url:a,type:"GET"}).success(function(c){}).fail(function(c,d){handleResursCheckoutError(getResursPhrase("purchaseAjaxInternalFailure"))})}handleResursCheckoutError(getResursPhrase("resursPurchaseNotAccepted"))});resursCheckout.setCustomerChangedEventCallback(function(d){if(omnivars.useStandardFieldsForShipping=="1"){console.log("Resurs Note: Received customer data update from iframe");var g=d.customerData;var c=g.address;var f=g.delivery;var b=false;var a=false;var e={first_name:"firstname",last_name:"surname",address_1:"address",address_2:"addressExtra",city:"city",country:"countryCode",email:"email",postcode:"postal",phone:"telephone"};if($RB("#ship-to-different-address-checkbox").length>0){if(typeof f.firstname!=="undefined"){b=true;if(!$RB("#ship-to-different-address-checkbox").is(":checked")){console.log("Resurs Bank Note: Shipping checkbox is not checked and there is a delivery address set in the iframe. Shipping fields should enable.");$RB("#ship-to-different-address-checkbox").attr("checked",false);$RB("#ship-to-different-address-checkbox").click()}}else{if($RB("#ship-to-different-address-checkbox").is(":checked")){console.log("Resurs Bank Note: Shipping checkbox is checked but there is no delivery address set in the iframe. Shipping fields should disable.");$RB("#ship-to-different-address-checkbox").click()}}}$RB("[id^=billing_]").each(function(j,k){if(typeof k.type==="string"&&(k.type=="text"||k.type=="email"||k.type=="tel")){var h=k.id.substr(k.id.indexOf("_")+1);if(typeof e[h]!=="undefined"){var l=e[h];if(typeof c[l]!=="undefined"){a=true;k.value=c[l]}}}});if(b){console.log("Shipping is now included!");a=false;$RB("[id^=shipping_]").each(function(j,k){if(typeof k.type==="string"&&(k.type=="text"||k.type=="email"||k.type=="tel")){var h=k.id.substr(k.id.indexOf("_")+1);if(typeof e[h]!=="undefined"){var l=e[h];if(typeof f[l]!=="undefined"){if(l=="postal"&&f[l]!=""){a=true}k.value=f[l]}}}})}if(a){$RB("body").trigger("update_checkout")}}});resursCheckout.setBookingCallback(function(c){var d=omnivars.OmniRef;var e=document.getElementsByTagName("iframe")[0];var b={};$RB('[name*="checkout"] input').each(function(f,g){if(typeof g.name!=="undefined"){if(g.type=="checkbox"){if(g.checked===true){c[g.name]=g.value}else{c[g.name]=0}}else{if(g.type=="radio"){c[g.name]=$RB('[name="'+g.name+'"]:checked').val()}else{c[g.name]=g.value}}}});if(typeof e!=="undefined"&&typeof e.src!=="undefined"){if(d!=""&&typeof omnivars.OmniPreBookUrl!=="undefined"){var a=omnivars.OmniPreBookUrl+"&orderRef="+d;$RB.ajax({url:a,type:"POST",data:c}).success(function(h){var g="";var f=false;if(typeof h.success!=="undefined"){if(h.success===true){f=true;resursCheckout.confirmOrder(true);return true}}g=(typeof h.errorString!=="undefined"?h.errorString:"");if(!f){if(g===""||g===null){g=getResursPhrase("theAjaxWasNotAccepted")}handleResursCheckoutError(g)}resursCheckout.confirmOrder(false);return false}).fail(function(f,j){resursCheckout.confirmOrder(false);var i=getResursPhrase("theAjaxWentWrong");if(typeof f.statusText!=="undefined"){i=f.statusText}var g=getResursPhrase("theAjaxWentWrongWithThisMessage");var h=getResursPhrase("contactSupport");handleResursCheckoutError(g+i+" - "+h);return false})}}})}function handleResursCheckoutError(a){var b=$RB("form.checkout");if(b.length>0){$RB(".woocommerce-error, .woocommerce-message").remove();b.prepend('<div class="woocommerce-error">'+a+"</div>");$RB("html, body").animate({scrollTop:($RB("form.checkout").offset().top-100)},1000)}else{alert(a)}};